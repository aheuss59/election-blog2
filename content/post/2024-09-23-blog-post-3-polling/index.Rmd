---
title: 'Blog Post 3: Polling'
author: Alex Heuss
date: '2024-09-23'
slug: blog-post-3-polling
categories: []
tags: []
---
```{r, load packages, echo=FALSE, message=FALSE}
library(car)
library(caret)
library(maps)
library(CVXR)
library(glmnet)
library(tidyverse)
```

```{r, load data, echo=FALSE, message=FALSE}
nat_poll_data <- read_csv("data/national_polls_1968-2024.csv")
state_av_poll_data <- read_csv("data/state_polls_1968-2024.csv")
national_pop_vote_data <- read_csv("data/popvote_1948-2020.csv") 
nat_pop_party_neutral <- 
  national_pop_vote_data |>
  mutate(dem_pv = ifelse(party == "democrat", pv, 0),
         rep_pv = ifelse(party == "republican", pv, 0),
         dem_2pv = ifelse(party == "democrat", pv2p, 0),
         rep_2pv = ifelse(party == "republican", pv2p, 0)) |>
  group_by(year) |>
  summarize(dem_pv = sum(dem_pv),
            rep_pv = sum(rep_pv),
            dem_2pv = sum(dem_2pv),
            rep_2pv = sum(rep_2pv))

```

## Historic Accuracy of Polls

Poll averages seem like an intuitive way to predict elections - intuitively, if I walk around and ask everyone who they are going to vote for, I should get a pretty good idea of how many people are voting for each candidate. However, historically, polls become more accurate as the election approaches, often converging near the correct value within a week or so of the election. Several theories attempt to explain this, including the "enlightened blah blah" theory expressed by so and so in their book *book*.

The following graph shows differences between polls and actual popular vote over the thirty-six weeks leading up the election from 2000-2020. 


```{r, lots of data wrangling, echo=FALSE, message=FALSE}

nat_poll_data_party_neutral <- 
  nat_poll_data |>
  mutate(dem_poll = ifelse(party=="DEM", poll_support, 0),
         rep_poll = ifelse(party=="REP", poll_support, 0)) |>
  select(-party, -candidate, -poll_support) |>
  group_by(year, weeks_left, poll_date) |>
  summarize(dem_poll = sum(dem_poll),
            rep_poll = sum(rep_poll))

clean_nat_data <- 
  nat_pop_party_neutral |>
  filter(year >= 1968) |>
  left_join(nat_poll_data_party_neutral, by = "year")

weekly_nat_data <- clean_nat_data |>
  group_by(year, weeks_left) |>
  summarize(av_d_pv = mean(dem_pv),
            av_r_pv = mean(rep_pv),
            av_d_2pv = mean(dem_2pv),
            av_r_2pv = mean(rep_2pv),
            av_d_poll = mean(dem_poll, na.rm = TRUE),
            av_r_poll = mean(rep_poll, na.rm = TRUE))

poll_data_for_merge <- nat_poll_data |> 
  mutate(party = ifelse(party == "DEM", "democrat", "republican")) |>
  group_by(year, party) |> 
  top_n(1, poll_date) |> 
  select(-candidate)

nov_data <- 
  national_pop_vote_data |> 
  left_join(poll_data_for_merge,
            by = c("year", "party")) |>
  rename(nov_poll = poll_support) |>
  filter(year <= 2020) |>
  drop_na()
```

```{r, echo=FALSE}
weekly_nat_data |>
  mutate(error_dem = av_d_poll - av_d_pv, 
         error_rep = av_r_poll - av_r_pv,
         Winner = ifelse(year %in% c(2008, 2012, 2020), "Democrat", "Republican"),
         error = ifelse(Winner == "Democrat", error_dem, error_rep)) |>
  filter(abs(error_dem) <= 100) |>
  filter(year %in% c(2020, 2016, 2012, 2008, 2004, 2000)) |>
  drop_na(weeks_left) |>
  group_by(weeks_left) |>
  ggplot(aes(x = weeks_left, y = error, color = Winner)) +
  geom_line(linewidth=0.75) +
  scale_x_reverse() +
  geom_hline(yintercept = 0) +
  facet_wrap(~year) +
  labs(x = "Weeks Before Election",
       y = "Error for Democratic Candidate (percentage points)",
       title = "Difference Between Polls and True Popular Vote (2000-2020)") +
  scale_color_manual(values = c("#00AEF3", "#E81B23")) +
  theme_bw()

```
Interpreting this graph, a perfect poll prediction would be at the line y = 0, which marks no difference between the poll predictions and the true popular vote. A difference above the line means that the winner was over-predicted to win and below marks an under-prediction. We can see that, in general, poll estimates are approaching zero as the election draws near. Another trend is that winners are often under-predicted. Notably, many polls, especially in recent years are also fairly accurate to begin with, with starting measures ending up very close to the end measure and variation in the middle. One reason for this may be that, because Americans are increasingly partisan, their views may change less over the course of the campaign.

The following graph visualizes the last poll prediction prior to the election and it's correlation with the actual result.

```{r, graph last poll preds and the actual result, echo=FALSE}

nov_data |>
  mutate(Party = ifelse(party == "democrat", "Democrat", "Republican")) |>
  ggplot(aes(x = nov_poll, y = pv, color = Party)) +
  geom_point() + 
  geom_smooth(method = "lm", linewidth = 0.75, se=FALSE) +
  geom_abline(slope = 1) + 
  geom_hline(yintercept = 50) +
  geom_vline(xintercept = 50) +
  scale_color_manual(values = c("#00AEF3", "#E81B23")) +
  labs(x = "Latest Poll Result (%)", 
       y = "National Popular Vote Share (%)", 
       title = "Final Poll Predictions and National Popular Vote Share (1968-2020)") +
  theme_bw()


```
In general, the final poll result is very similar to the true election popular vote. This graph also shows the tendency of polls to under-predict the true popular vote, which may be due to the influence of third parties. Perhaps, voters who are questioned by pollsters are more likely to say they will be voting for a third party candidate than to actually do it. 

# 2024 Polls Thus Far

In predicting the 2024 election, we in some ways have less polling data to work with, owing to Biden's late-in-the-game dropout.

```{r, 2024 nat polls graph, echo=FALSE}
nat_poll_data |> 
  filter(year == 2024 & (poll_date > '2024-07-21' | poll_date == '2024-07-21')) |> 
  mutate(Candidate = ifelse(party == "DEM", "Kamala Harris", "Donald Trump")) |>
  ggplot(aes(x = poll_date, y = poll_support, color = Candidate)) +
  geom_point(size = 1) + 
  geom_line() + 
  scale_x_date(date_labels = "%b %d") + 
  scale_color_manual(values = c("#E81B23", "#00AEF3")) +
  labs(x = "Date",
       y = "Average Poll Approval", 
       title = "Polling Averages Post-Biden Dropout") + 
  theme_bw()
```


## State Level
```{r, load in more data and merge, echo=FALSE, message=FALSE}
state_pop_data <- read_csv("data/clean_wide_state_2pv_1948_2020.csv")
ec <- read_csv("data/corrected_ec_1948_2024.csv")
```


```{r, state data wrangling, echo=FALSE, message=FALSE}
clean_state_polls <- 
  state_av_poll_data |>
  mutate(party = ifelse(party == "DEM", "democrat", "republican"),
         dem_support = ifelse(party == "democrat", poll_support, 0),
         rep_support = ifelse(party == "republican", poll_support, 0)) |>
  select(-party, -candidate, -days_left, -poll_support) |>
  group_by(year, weeks_left, state, poll_date) |>
  summarize(dem_support = sum(dem_support),
            rep_support = sum(rep_support))

merged_state_data <- 
  state_pop_data |>
  filter(year >= 1972) |>
  left_join(clean_state_polls, by = c("state", "year")) |>
  select(year, state, D_pv, R_pv, D_pv2p, R_pv2p, weeks_left, poll_date, dem_support, rep_support) |>
  left_join(ec, by = c("state", "year"))

average_state_data <- 
  merged_state_data |>
  group_by(year, state) |>
  summarize(av_d_pv = mean(D_pv),
            av_r_pv = mean(R_pv),
            av_d_2pv = mean(D_pv2p),
            av_r_2pv = mean(R_pv2p),
            av_d_poll = mean(dem_support, na.rm = TRUE),
            av_r_poll = mean(rep_support, na.rm = TRUE))
  
weekly_state_data <- 
  merged_state_data |>
  group_by(year, state, weeks_left) |>
  summarize(av_d_pv = mean(D_pv),
            av_r_pv = mean(R_pv),
            av_d_2pv = mean(D_pv2p),
            av_r_2pv = mean(R_pv2p),
            av_d_poll = mean(dem_support, na.rm = TRUE),
            av_r_poll = mean(rep_support, na.rm = TRUE))

```
